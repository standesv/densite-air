<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>RideScore — météo moto</title>
  <link rel="preconnect" href="https://api.open-meteo.com"/>
  <link rel="preconnect" href="https://geocoding-api.open-meteo.com"/>
  <style>
    :root{
      --bg:#0b1120; --panel:#101826; --muted:#9fb0c7; --brand:#13b0a6; --brand-ink:#062a2b;
      --ok:#10b981; --warn:#f6b234; --err:#ef4444; --text:#e5e7eb;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:var(--bg);color:var(--text)}
    header{padding:16px;background:#0f172a}
    .header-brand{display:flex;gap:12px;align-items:center;justify-content:center}
    .header-brand img{height:64px;width:auto;display:block}
    .header-brand h1{margin:0;font-size:1.7rem}
    .header-brand p{margin:3px 0 0;color:var(--muted)}
    .container{max-width:980px;margin:0 auto;padding:0 10px 90px}
    .card{background:var(--panel);border:1px solid #ffffff14;border-radius:14px;padding:10px;margin-top:10px}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:4px}
    input{width:100%;padding:10px;border-radius:10px;border:1px solid #ffffff22;background:#0b1220;color:var(--text)}
    button{border:0;border-radius:10px;padding:10px 12px;font-weight:600;cursor:pointer;background:var(--brand);color:var(--brand-ink)}
    .row{display:flex;gap:8px;flex-wrap:wrap}.row>*{flex:1 1 160px}
    .grid{display:grid;gap:10px}.three{grid-template-columns:repeat(3,1fr)}
    @media(max-width:900px){.three{grid-template-columns:1fr}}
    .tabs{display:flex;gap:8px}
    .tabs button{flex:1}
    .results{display:grid;gap:6px;margin-top:6px}
    .cityItem{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;background:#0b1220;border:1px solid #ffffff14;color:#fff;cursor:pointer}
    .lamps{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:6px}
    .lamp{display:flex;gap:8px;align-items:center;background:#0b1220;border:1px solid #ffffff14;border-radius:10px;padding:8px}
    .led{width:9px;height:9px;border-radius:50%;background:#334155}
    .on.green{background:#10b981}.on.yellow{background:#f6b234}.on.red{background:#ef4444}
    .muted{color:var(--muted)}
    .stickyBar{position:fixed;left:0;right:0;bottom:0;z-index:10;display:flex;gap:8px;padding:10px;background:var(--bg);border-top:1px solid #ffffff14}
    .stickyBar button{flex:1}
    .modepill{display:inline-flex;background:#0b1220;border:1px solid #ffffff1f;border-radius:999px;overflow:hidden;margin-top:6px}
    .modepill button{background:transparent;border:0;padding:6px 12px;font-size:12px;color:#cbd5e1;cursor:pointer}
    .modepill button.active{background:#13b0a6;color:#062a2b;font-weight:600}
    /* jauges sous les voyants */
    .gaugesRow{
      display:flex;
      gap:6px;             /* réduit */
      margin-top:10px;
      flex-wrap:wrap;
      justify-content:center;
    }
    .gBox{
      flex:0 1 135px;       /* un poil plus petit */
      min-width:130px;
      text-align:left;
    }
    .gBox p{margin:0 0 4px}
    .gaugeSVG{
      width:120px;          /* taille réduite */
      max-width:100%;
      height:auto;
      display:block;
    }
    .guidance{color:#cbd5e1;font-size:12px;margin-top:4px}
    @media(max-width:460px){
      .gBox{
        flex:1 1 100%;
        display:flex;
        flex-direction:column;
        align-items:center;
        text-align:center;
      }
      .gBox p{text-align:center}
      .gaugeSVG{margin:0 auto;}
    }
  </style>
</head>
<body>
<header>
  <div class="header-brand">
    <img src="ridescore-logo.png" alt="RideScore, météo moto">
    <div>
      <h1>RideScore</h1>
      <p>Densité de l’air, score météo, voyants</p>
    </div>
  </div>
</header>

<main class="container">
  <!-- 1. sélection -->
  <section class="card">
    <h2 style="margin:0 0 6px">Ville ou itinéraire</h2>
    <div class="tabs">
      <button id="tabSingle" aria-selected="true">Ville</button>
      <button id="tabRoute" aria-selected="false" style="background:#1f2937;color:#e5e7eb">Itinéraire</button>
    </div>

    <div id="panelSingle" style="margin-top:8px">
      <div class="modepill" id="modePill">
        <button type="button" data-mode="day" class="active">Jour (moy.)</button>
        <button type="button" data-mode="now">Temps réel</button>
      </div>
      <div class="grid three" style="margin-top:6px">
        <div>
          <label for="city">Ville</label>
          <input id="city" placeholder="Ex. Paris…" autocomplete="off"/>
          <div id="results" class="results"></div>
        </div>
        <div>
          <label for="date">Date</label>
          <input id="date" type="date"/>
        </div>
      </div>
      <details>
        <summary>Options avancées</summary>
        <div class="row" style="margin-top:6px">
          <div>
            <label for="lat">Latitude</label>
            <input id="lat" type="number" step="0.0001" placeholder="48.8566"/>
          </div>
          <div>
            <label for="lon">Longitude</label>
            <input id="lon" type="number" step="0.0001" placeholder="2.3522"/>
          </div>
        </div>
      </details>
      <p id="status" class="muted" style="margin:6px 0 0;"></p>
    </div>

    <div id="panelRoute" style="margin-top:8px;display:none">
      <div class="grid three">
        <div>
          <label for="cityA">Ville départ</label>
          <input id="cityA" autocomplete="off"/>
          <div id="resultsA" class="results"></div>
        </div>
        <div>
          <label for="cityB">Ville arrivée</label>
          <input id="cityB" autocomplete="off"/>
          <div id="resultsB" class="results"></div>
        </div>
        <div>
          <label for="dateRoute">Date</label>
          <input id="dateRoute" type="date"/>
        </div>
      </div>
      <p id="statusRoute" class="muted" style="margin:6px 0 0;"></p>
    </div>
  </section>

  <!-- 2. voyants + jauges -->
  <section class="card">
    <div id="lamps" class="lamps"></div>
    <div class="gaugesRow">
      <div class="gBox">
        <p class="muted">Score météo</p>
        <div id="gScore"></div>
        <div id="gScoreTxt" class="guidance">—</div>
      </div>
      <div class="gBox">
        <p class="muted">Densité de l’air</p>
        <div id="gRho"></div>
        <div id="gRhoTxt" class="guidance">—</div>
      </div>
    </div>
  </section>

  <!-- 3. phénomènes -->
  <section class="card">
    <h2 style="margin:0 0 6px">Phénomènes du jour</h2>
    <p id="dayMsg" class="muted">—</p>
  </section>

  <!-- 4. KPIs -->
  <section class="card">
    <h2 style="margin:0 0 6px">Détails</h2>
    <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:8px">
      <div class="kpi"><div class="label">
